#INCOMPLETE CODE JUST USED FOR INITIAL TESTING

import geopandas as gpd
from cmu_112_graphics import *
import pandas as pd
from shapely.geometry import Point, Polygon

# shapefile = '/Users/noraeverly/Desktop/TermProject/ne_110m_admin_1_states_provinces'

# #Read shapefile using Geopandas
# gdf = gpd.read_file(shapefile)  #[['adm1_code', 'iso_3166_2', 'geometry']]

# #gives column labels
# # print(gdf.dtypes)

# gdf = gdf[['name_en', 'iso_3166_2', 'geometry']]

# #rename columns
# gdf.columns = ['state', 'state_code', 'geometry']
# gdf.head()

# print(gdf)


def appStarted(app):
    shapefile = '/Users/noraeverly/Desktop/TermProject/ne_110m_admin_1_states_provinces'
    app.data = gpd.read_file(shapefile)[['name_en', 'iso_3166_2', 'geometry']]
    app.data.columns = ['state', 'state_code', 'geometry']
    app.data.head()
    app.color = 'red'
    # app.va = [(-83.33059243922776, 36.67266067363208), (-83.17850875854492, 36.71838188171387), (-83.09948313683732, 36.80443780881003), (-83.08908301464577, 36.81576345473316), (-83.0733530067755, 36.82260930628833), (-82.81550788879395, 36.93482780456543), (-82.70913176984146, 37.040143442951724), (-82.68479244661029, 37.121093654929695), (-82.68479213152052, 37.12109377295471), (-82.6847915649414, 37.12109565734863), (-82.37258911132812, 37.23803901672363), (-82.07538986207479, 37.459358179410245), (-81.9725361803314, 37.53595205336886), (-81.92809444856039, 37.366091620425465), (-81.83874171324607, 37.29435542623226), (-81.81538772583008, 37.27560615539551), (-81.66351127624512, 37.195173263549805), (-81.43343360042127, 37.28319918373153), (-81.3481298489487, 37.31583629002162), (-81.3481292729979, 37.31583595255335), (-81.34812927246094, 37.31583595275879), (-81.22800827026367, 37.24545478820801), (-80.91531813243837, 37.31553155101449), (-80.85492997915506, 37.32906545668834), (-80.84166996984384, 37.38376497066467), (-80.833251953125, 37.41849327087402), (-80.72000312805176, 37.38304328918457), (-80.60294111399195, 37.452076624914405), (-80.59618608266965, 37.456060289045624), (-80.5961859173229, 37.45606027207203), (-80.5961856842041, 37.4560604095459), (-80.45699501037598, 37.44177436828613), (-80.29824533321333, 37.519029200305404), (-80.28577911611927, 37.57167259382654), (-80.27656755677725, 37.610574309812414), (-80.29297461619709, 37.7280591904139), (-80.29297442533623, 37.728059434204695), (-80.2929744720459, 37.72805976867676), (-80.15750503540039, 37.90109825134277), (-79.96436348401359, 38.031789518560714), (-79.91514238149504, 38.17942698826727), (-79.81891914251666, 38.27920277298852), (-79.74367926400072, 38.35722137799588), (-79.64792355011377, 38.57472585708395), (-79.64792348203814, 38.57472581747799), (-79.64792251586914, 38.57472801208496), (-79.51508903503418, 38.497446060180664), (-79.36639022827148, 38.42602729797363), (-79.22298812866211, 38.46463203430176), (-79.17482566833496, 38.5556583404541), (-79.07640838623047, 38.68001747131348), (-79.00735469485451, 38.76812744525416), (-78.96527787953812, 38.82181671808755), (-78.96527744663842, 38.821816468533605), (-78.96527671813965, 38.82181739807129), (-78.89280128479004, 38.780038833618164), (-78.74461936950684, 38.90915107727051), (-78.6299356254404, 38.985706719408256), (-78.54884334991405, 39.039839585926956), (-78.51354985444293, 39.068071449123266), (-78.42448425292969, 39.13931846618652), (-78.36231391159738, 39.34917137453467), (-78.34562577992627, 39.40550202082426), (-78.34562560474399, 39.40550192787474), (-78.34562492370605, 39.40550422668457), (-77.881075040849, 39.159017223477484), (-77.83498511423412, 39.13456248631796), (-77.72279557972846, 39.32243215591507), (-77.69582987282635, 39.31620052507624), (-77.57621574401855, 39.28856086730957), (-77.44340705871582, 39.213422775268555), (-77.44340804127478, 39.213421340218346), (-77.44340694854247, 39.213420721995476), (-77.50088163990247, 39.12947981343377), (-77.5169677734375, 39.10598564147949), (-77.30581855773926, 39.04567909240723), (-77.11955070495605, 38.93400764465332), (-77.11954986485948, 38.9340067776485), (-77.03647994995117, 38.848276138305664), (-77.04123497009277, 38.7895450592041), (-77.04123501575428, 38.7895448536498), (-77.05921745300293, 38.70859336853027), (-77.09807033337478, 38.687120586479026), (-77.22962154815099, 38.61441335708423), (-77.34338699431744, 38.39161084918188), (-77.21057891845703, 38.33711814880371), (-77.0481071472168, 38.380502700805664), (-77.00225319734794, 38.26961787393406), (-76.98989486694336, 38.23973274230957), (-76.3016185760498, 37.91794776916504), (-76.25873947143555, 36.96640205383301), (-75.97179985046387, 36.897260665893555), (-75.86807632446289, 36.55117988586426), (-75.86807671493632, 36.551179883937685), (-75.8680767483408, 36.55118012139883), (-75.99324725779447, 36.550562300522934), (-76.94121551513672, 36.54588508605957), (-77.99954795837402, 36.53743553161621), (-79.99239730834961, 36.54218864440918), (-81.67937469482422, 36.58557319641113), (-82.06990138690504, 36.570483202477405), (-82.18632158072288, 36.565985419250396), (-83.67328420892706, 36.59985930073531), (-83.38436126708984, 36.65649604797363), (-83.33059243922776, 36.67266067363208), (-75.37754063414677, 38.01537999412076), (-75.94003486633301, 37.216875076293945), (-76.03106307983398, 37.25656318664551), (-75.72205038686438, 37.93705028942895), (-75.72204971313477, 37.93705177307129), (-75.60984992980957, 38.00003242492676), (-75.37753868103027, 38.01538276672363), (-75.37754063414677, 38.01537999412076)]
    

def mousePressed(app, event):
    long = (event.x - app.width/1.3)/4
    lat = -(event.y - app.height/2)/4
    yeet = {'long':long, 'lat':lat}
    df = pd.DataFrame(yeet, index=[0])

    va = Polygon(app.va)

    # point = gpd.GeoDataFrame(df, geometry=gpd.points_from_xy(df.long, df.lat))
    
    point = Point(long, lat)

    # print(point[['geometry']])

    if point.within(va):
        if app.color == 'red':
            app.color = 'blue'
        else:
            app.color = 'red'
    else:
        app.color = 'purple'
    # print(va.contains(point))


def pointInState(point, poly):
    return poly.contains(point) #or point.within(poly)


# need to find good ratios to orient map well
def drawMap(app, canvas):
    for index, row in app.data.iterrows():
        print(row['state_code'][3:])
        polygon = (row['geometry'])
        if polygon.geom_type == 'Polygon':
            points = list(polygon.exterior.coords)
            for i in range(len(points)):
                x, y = points[i]
                x = int(x*4 + app.width/1.3)
                y = int(-y*4 + app.height/2)
                points[i] = (x, y)
            canvas.create_polygon(points, fill='purple')
      
    #   for  multipolygons (need to fix this!)
        else:
            # print(row['iso_3166_2'])
            polygons = list(polygon)
            for item in polygons:
                points = list(item.exterior.coords)
                for i in range(len(points)):
                    x, y = points[i]
                    x = int(x*4 + app.width/1.3)
                    y = int(-y*4 + app.height/2)
                    points[i] = (x, y)
                canvas.create_polygon(points, fill=app.color)
            
    # va = [(-83.33059243922776, 36.67266067363208), (-83.17850875854492, 36.71838188171387), (-83.09948313683732, 36.80443780881003), (-83.08908301464577, 36.81576345473316), (-83.0733530067755, 36.82260930628833), (-82.81550788879395, 36.93482780456543), (-82.70913176984146, 37.040143442951724), (-82.68479244661029, 37.121093654929695), (-82.68479213152052, 37.12109377295471), (-82.6847915649414, 37.12109565734863), (-82.37258911132812, 37.23803901672363), (-82.07538986207479, 37.459358179410245), (-81.9725361803314, 37.53595205336886), (-81.92809444856039, 37.366091620425465), (-81.83874171324607, 37.29435542623226), (-81.81538772583008, 37.27560615539551), (-81.66351127624512, 37.195173263549805), (-81.43343360042127, 37.28319918373153), (-81.3481298489487, 37.31583629002162), (-81.3481292729979, 37.31583595255335), (-81.34812927246094, 37.31583595275879), (-81.22800827026367, 37.24545478820801), (-80.91531813243837, 37.31553155101449), (-80.85492997915506, 37.32906545668834), (-80.84166996984384, 37.38376497066467), (-80.833251953125, 37.41849327087402), (-80.72000312805176, 37.38304328918457), (-80.60294111399195, 37.452076624914405), (-80.59618608266965, 37.456060289045624), (-80.5961859173229, 37.45606027207203), (-80.5961856842041, 37.4560604095459), (-80.45699501037598, 37.44177436828613), (-80.29824533321333, 37.519029200305404), (-80.28577911611927, 37.57167259382654), (-80.27656755677725, 37.610574309812414), (-80.29297461619709, 37.7280591904139), (-80.29297442533623, 37.728059434204695), (-80.2929744720459, 37.72805976867676), (-80.15750503540039, 37.90109825134277), (-79.96436348401359, 38.031789518560714), (-79.91514238149504, 38.17942698826727), (-79.81891914251666, 38.27920277298852), (-79.74367926400072, 38.35722137799588), (-79.64792355011377, 38.57472585708395), (-79.64792348203814, 38.57472581747799), (-79.64792251586914, 38.57472801208496), (-79.51508903503418, 38.497446060180664), (-79.36639022827148, 38.42602729797363), (-79.22298812866211, 38.46463203430176), (-79.17482566833496, 38.5556583404541), (-79.07640838623047, 38.68001747131348), (-79.00735469485451, 38.76812744525416), (-78.96527787953812, 38.82181671808755), (-78.96527744663842, 38.821816468533605), (-78.96527671813965, 38.82181739807129), (-78.89280128479004, 38.780038833618164), (-78.74461936950684, 38.90915107727051), (-78.6299356254404, 38.985706719408256), (-78.54884334991405, 39.039839585926956), (-78.51354985444293, 39.068071449123266), (-78.42448425292969, 39.13931846618652), (-78.36231391159738, 39.34917137453467), (-78.34562577992627, 39.40550202082426), (-78.34562560474399, 39.40550192787474), (-78.34562492370605, 39.40550422668457), (-77.881075040849, 39.159017223477484), (-77.83498511423412, 39.13456248631796), (-77.72279557972846, 39.32243215591507), (-77.69582987282635, 39.31620052507624), (-77.57621574401855, 39.28856086730957), (-77.44340705871582, 39.213422775268555), (-77.44340804127478, 39.213421340218346), (-77.44340694854247, 39.213420721995476), (-77.50088163990247, 39.12947981343377), (-77.5169677734375, 39.10598564147949), (-77.30581855773926, 39.04567909240723), (-77.11955070495605, 38.93400764465332), (-77.11954986485948, 38.9340067776485), (-77.03647994995117, 38.848276138305664), (-77.04123497009277, 38.7895450592041), (-77.04123501575428, 38.7895448536498), (-77.05921745300293, 38.70859336853027), (-77.09807033337478, 38.687120586479026), (-77.22962154815099, 38.61441335708423), (-77.34338699431744, 38.39161084918188), (-77.21057891845703, 38.33711814880371), (-77.0481071472168, 38.380502700805664), (-77.00225319734794, 38.26961787393406), (-76.98989486694336, 38.23973274230957), (-76.3016185760498, 37.91794776916504), (-76.25873947143555, 36.96640205383301), (-75.97179985046387, 36.897260665893555), (-75.86807632446289, 36.55117988586426), (-75.86807671493632, 36.551179883937685), (-75.8680767483408, 36.55118012139883), (-75.99324725779447, 36.550562300522934), (-76.94121551513672, 36.54588508605957), (-77.99954795837402, 36.53743553161621), (-79.99239730834961, 36.54218864440918), (-81.67937469482422, 36.58557319641113), (-82.06990138690504, 36.570483202477405), (-82.18632158072288, 36.565985419250396), (-83.67328420892706, 36.59985930073531), (-83.38436126708984, 36.65649604797363), (-83.33059243922776, 36.67266067363208), (-75.37754063414677, 38.01537999412076), (-75.94003486633301, 37.216875076293945), (-76.03106307983398, 37.25656318664551), (-75.72205038686438, 37.93705028942895), (-75.72204971313477, 37.93705177307129), (-75.60984992980957, 38.00003242492676), (-75.37753868103027, 38.01538276672363), (-75.37754063414677, 38.01537999412076)]
    # va = [(-155.93665000000001, 19.059390000000064), (-155.90806000000003, 19.338880000000017), (-156.07347000000001, 19.7029399999999), (-156.02368, 19.814220000000034), (-155.85008, 19.97729000000004), (-155.91907, 20.17394999999999), (-155.86108000000002, 20.267210000000034), (-155.78504999999996, 20.248700000000042), (-155.40213999999997, 20.079749999999933), (-155.22452000000004, 19.993020000000172), (-155.06226000000004, 19.859099999999955), (-154.80740999999998, 19.50871000000012), (-154.83146999999994, 19.453280000000007), (-155.22217000000003, 19.239720000000148), (-155.54211, 19.08348000000001), (-155.68816999999999, 18.916190000000142), (-155.93665000000001, 19.059390000000064), (-155.99566000000002, 20.764040000000023), (-156.07925999999998, 20.643969999999968), (-156.41445000000002, 20.572410000000048), (-156.58672999999996, 20.783000000000072), (-156.70166999999998, 20.864300000000128), (-156.71055, 20.926759999999945), (-156.61257999999998, 21.012490000000128), (-156.25711, 20.917450000000088), (-155.99566000000002, 20.764040000000023), (-156.75823999999997, 21.17684000000014), (-156.78933000000004, 21.068729999999903), (-157.32521000000003, 21.097770000000025), (-157.25027, 21.219579999999894), (-156.75823999999997, 21.17684000000014), (-158.12667000000002, 21.312440000000095), (-158.2538, 21.539189999999962), (-158.29264999999998, 21.579120000000103), (-158.02520000000004, 21.716959999999915), (-157.94161000000003, 21.6527200000001), (-157.65283000000002, 21.322169999999915), (-157.70702999999997, 21.264420000000086), (-157.77860000000004, 21.277289999999994), (-158.12667000000002, 21.312440000000095), (-159.80050999999997, 22.06533000000013), (-159.74877, 22.138199999999927), (-159.59619999999998, 22.236180000000104), (-159.36568999999997, 22.214940000000013), (-159.34512000000004, 21.98200000000014), (-159.46372, 21.882990000000063), (-159.80050999999997, 22.06533000000013)]
    # ak = [(-153.22872941792107, 57.968968410872435), (-152.5647906158351, 57.90142731386709), (-152.14114722390633, 57.59105866152203), (-153.0063140533369, 57.115842190166006), (-154.0050902984581, 56.73467682558106), (-154.51640275777007, 56.992748928446815), (-154.67099280497115, 57.46119578717253), (-153.76277950744145, 57.81657461204378), (-153.22872941792107, 57.968968410872435), (-166.46779212142462, 60.38416982689773), (-165.67442969466367, 60.29360687930625), (-165.57916419173358, 59.909986884187674), (-166.19277014876727, 59.7544408229889), (-166.848337368822, 59.94140615502107), (-167.45527706609005, 60.21306915957939), (-166.46779212142462, 60.38416982689773), (-171.73165686753939, 63.782515367276005), (-171.11443356024523, 63.592191067144995), (-170.4911124339407, 63.69497549097355), (-169.68250545965356, 63.43111562769127), (-168.68943946030066, 63.2975062120006), (-168.7719408844546, 63.18859813094548), (-169.52943986720504, 62.97693146427798), (-170.29055620021597, 63.19443756779441), (-170.67138566799088, 63.375821845139), (-171.55306311753867, 63.31778921167512), (-171.79111060289117, 63.4058458523005), (-171.73165686753939, 63.782515367276005), (-140.9859883290049, 69.71199839952624), (-140.98598752156073, 69.71199839952624), (-140.99249875202946, 66.00002859156871), (-140.99776974812323, 60.3063967962986), (-140.0129978161532, 60.27683787702762), (-139.03900042031586, 60.000007229240055), (-138.34087765826888, 59.56210114199871), (-137.4525081107393, 58.90498362897523), (-136.47972511106087, 59.463864244211834), (-135.4758328991428, 59.787772121817284), (-134.94498674842458, 59.270542711008034), (-134.27110023312235, 58.86111033795942), (-133.3555488822072, 58.41028514264519), (-132.730420695661, 57.69288707135314), (-131.70782161525324, 56.552103990293915), (-130.0077703457152, 55.91581207948417), (-129.97999426335826, 55.28499787049725), (-130.53611018946725, 54.8027534043494), (-131.08581823797215, 55.17890615500187), (-131.9672114671423, 55.49777558045906), (-132.25001074285956, 56.36999624289746), (-133.53918108435641, 57.17888743756214), (-134.07806292029613, 58.12306753196691), (-135.03821103227915, 58.18771474876394), (-136.62806230995477, 58.21220937767032), (-137.800006279686, 58.49999542910382), (-139.867787041413, 59.53776154238915), (-140.825273817133, 59.727517401764885), (-142.57444353556446, 60.084446519605024), (-143.9588809948799, 59.99918040632343), (-145.92555681682782, 60.458609727614316), (-147.11437394914665, 60.884656073644635), (-148.22430620012764, 60.672989406977024), (-148.01806555885076, 59.97832896589364), (-148.57082251686077, 59.91417267520313), (-149.72785783587585, 59.70565827090559), (-150.60824337461634, 59.36821116803952), (-151.7163927886833, 59.15582103131999), (-151.85943315326716, 59.74498403587961), (-151.40971900124717, 60.72580272077943), (-150.3469414947325, 61.03358755150987), (-150.62111080625706, 61.284424953854455), (-151.89583919981683, 60.72719798445132), (-152.57832984109558, 60.06165721296429), (-154.0191721262576, 59.35027944603428), (-153.28751135965308, 58.86472768821983), (-154.23249243875847, 58.14637360293057), (-155.30749142151012, 57.72779450136636), (-156.30833472392308, 57.42277435976365), (-156.5560973785464, 56.97998484967064), (-158.11721655986773, 56.46360809999402), (-158.43332129619714, 55.994153550838575), (-159.60332739971744, 55.56668610292013), (-160.2897196116342, 55.643580634170405), (-161.2230476552578, 55.364734605523495), (-162.23776607974096, 55.02418691672011), (-163.06944658104638, 54.68973704692718), (-164.7855692210273, 54.404173082082195), (-164.9422263255201, 54.57222483989534), (-163.84833960676565, 55.03943146424615), (-162.8700013906159, 55.34804311789321), (-161.804174974596, 55.894986477270436), (-160.56360470278122, 56.00805451112507), (-160.0705598622844, 56.41805532492879), (-158.68444291891953, 57.01667511659787), (-158.46109737855406, 57.21692129172891), (-157.72277035218386, 57.57000051536306), (-157.55027442119365, 58.32832632103026), (-157.041674974577, 58.91888458926172), (-158.19473120830557, 58.615802313869835), (-158.51721798402306, 58.78778148053732), (-159.05860612692882, 58.424186102931685), (-159.71166704001732, 58.931390285876375), (-159.98128882550017, 58.572549140041644), (-160.3552711659965, 59.07112335879367), (-161.35500342511511, 58.670837714260756), (-161.96889360252644, 58.67166453717738), (-162.05498653872465, 59.26692536074745), (-161.87417070213542, 59.63362132429063), (-162.51805904849215, 59.98972361921392), (-163.81834143782024, 59.79805573184342), (-164.66221757714655, 60.26748444278269), (-165.3463877024748, 60.50749563256244), (-165.35083187565192, 61.073895168697504), (-166.12137915755605, 61.50001902937623), (-165.7344518707706, 62.07499685327184), (-164.91917863671785, 62.63307648380794), (-164.56250790103934, 63.14637848576308), (-163.7533324859971, 63.2194489610236), (-163.0672244944579, 63.05945872664802), (-162.2605553863817, 63.54193573674121), (-161.53444983624857, 63.455816962326764), (-160.7725066803211, 63.7661081000233), (-160.95833513084264, 64.2227985704028), (-161.5180684072121, 64.40278758407533), (-160.77777767641484, 64.78860382756642), (-161.3919262359876, 64.77723501246214), (-162.45305009666893, 64.55944468856808), (-162.7577860178941, 64.33860545516882), (-163.54639421288428, 64.5591604681905), (-164.96082984114514, 64.44694509546872), (-166.4252882558645, 64.68667206487072), (-166.84500423893914, 65.08889557561457), (-168.11056006576706, 65.66999705673675), (-166.70527116602193, 66.08831777613943), (-164.4747096425755, 66.5766600612975), (-163.65251176659567, 66.5766600612975), (-163.78860165103626, 66.0772073431965), (-161.67777442121013, 66.11611969671242), (-162.48971452538007, 66.73556509059512), (-163.7197169667912, 67.11639455837013), (-164.43099138085654, 67.61633820257782), (-165.39028683170673, 68.04277212185025), (-166.76444068099607, 68.35887685817971), (-166.2047074046267, 68.8830309109162), (-164.43081051334357, 68.91553538682774), (-163.16861365461452, 69.37111481391293), (-162.930566169262, 69.85806183539927), (-161.9088972646355, 70.33332998318764), (-160.93479651593367, 70.44768992784958), (-159.03917578838704, 70.89164215766897), (-158.11972286683397, 70.82472117785107), (-156.58082455139802, 71.35776357694175), (-155.0677902903243, 71.14777639432373), (-154.3441652089412, 70.69640859647023), (-153.9000062733925, 70.88998851183572), (-152.2100060699353, 70.82999217394467), (-152.27000240782613, 70.60000621202988), (-150.7399924387445, 70.43001658800574), (-149.72000301816752, 70.53001048449045), (-147.61336157935696, 70.2140349392418), (-145.68998980022536, 70.12000967068678), (-144.92001095907642, 69.9899917670403), (-143.58944618042528, 70.15251414659832), (-142.07251034871354, 69.85193817817265), (-140.9859883290049, 69.71199839952624)]
    # for i in range(len(va)):
    #     x, y = va[i]
    #     x = int(x*4 + app.width/1.3)
    #     y = int(-y*4 + app.height/2)
    #     va[i] = (x, y)
    # canvas.create_polygon(va, fill='black')
        


def redrawAll(app, canvas):
    drawMap(app, canvas)

runApp(width=1000, height=1000)

#create a state class
# name, abbreviation, points
# Any poll information we need

